function selectFile(n){$("#pnlFileList li").removeClass("selected");$(n).prop("class","selected");var i=RoxyUtils.GetFilename($(n).attr("data-path"));i+=" ("+t("Size")+": "+RoxyUtils.FormatFileSize($(n).attr("data-size"));$(n).attr("data-w")>0&&(i+=", "+t("Dimensions")+":"+$(n).attr("data-w")+"x"+$(n).attr("data-h"));i+=")";$("#pnlStatus").html(i)}function getLastDir(){return RoxyUtils.GetCookie("roxyld")}function setLastDir(n){RoxyUtils.SetCookie("roxyld",n,10)}function selectDir(n){var t=Directory.Parse($(n).parent("li").attr("data-path"));t&&t.Select()}function startDragDir(){}function startDragFile(){selectFile(this)}function dragFileOver(){$(this).children("img.dir").attr("src","images/folder-green.png")}function dragFileOut(){$("#pnlDirList").find("img.dir").attr("src","images/folder.png")}function makeDragFile(n){var t=new File($(n.target).closest("li").attr("data-path"));return'<div class="pnlDragFile" data-path="'+t.fullPath+'"><img src="'+t.bigIcon+'" align="absmiddle">&nbsp;'+t.name+"<\/div>"}function makeDragDir(n){var t=new Directory($(n.target).attr("data-path")?$(n.target).attr("data-path"):$(n.target).closest("li").attr("data-path"));return'<div class="pnlDragDir" data-path="'+t.fullPath+'"><img src="images/folder.png" align="absmiddle">&nbsp;'+t.name+"<\/div>"}function moveDir(n,t,i){var r=Directory.Parse(t.draggable.attr("data-path")),u=Directory.Parse($(i).parent("li").attr("data-path"));u.fullPath!=r.path&&r.Move(u.fullPath)}function moveFile(n,t,i){var r=new File(t.draggable.attr("data-path")),u=Directory.Parse($(i).parent("li").attr("data-path")),f=Directory.Parse(r.path);r.path!=u.fullPath&&r.Move(u.fullPath)}function moveObject(n,t){n.stopPropagation();t.draggable.hasClass("directory")?moveDir(n,t,this):moveFile(n,t,this);dragFileOut()}function clickFirstOnEnter(n){$("#"+n).unbind("keypress");$(".actions input").each(function(){this.blur()});$("#"+n).keypress(function(n){n.keyCode==$.ui.keyCode.ENTER&&(n.stopPropagation(),$(this).parent().find(".ui-dialog-buttonset button").eq(0).trigger("click"))})}function addDir(){var i=getSelectedDir(),n;i&&(clickFirstOnEnter("pnlDirName"),$("#txtDirName").val(""),n={},n[t("CreateDir")]=function(){var n=$.trim($("#txtDirName").val());n||alert(t("E_MissingDirName"));i.Create(n)&&$("#pnlDirName").dialog("close")},n[t("Cancel")]=function(){$("#pnlDirName").dialog("close")},$("#pnlDirName").dialog({title:t("T_CreateDir"),modal:!0,buttons:n}))}function showUploadList(n){var t=$("#uploadFilesList");for(t.html(""),clearFileField(),i=0;i<n.length;i++)t.append('<div class="fileUpload"><div class="fileName">'+n[i].name+" ("+RoxyUtils.FormatFileSize(n[i].size)+')<span class="progressPercent"><\/span><div class="uploadProgress"><div class="stripes"><\/div><\/div><\/div><a class="removeUpload" onclick="removeUpload('+i+')"><\/a><\/div>');n.length>0?$("#btnUpload").button("enable"):$("#btnUpload").button("disable")}function listUploadFiles(n){window.FileList?n.length>0&&(uploadFileList=[],addUploadFiles(n)):$("#btnUpload").button("enable")}function addUploadFiles(n){for(console.log("Adicionando"),i=0;i<n.length;i++)uploadFileList.push(n[i]);showUploadList(uploadFileList)}function removeUpload(n){var t=findUploadElement(n);t.remove();try{uploadFileList.splice(n,1);showUploadList(uploadFileList)}catch(i){}}function findUploadElement(n){return $("#uploadFilesList .fileUpload:eq("+n+")")}function updateUploadProgress(n,t){var r=findUploadElement(t),i=99;n.lengthComputable&&(i=Math.floor(n.loaded/n.total*100));i>99&&(i=99);r.find(".uploadProgress").css("width",i+"%");r.find(".progressPercent").html(" - "+i+"%")}function uploadComplete(n,t){uploadFinished(n,t,"ok")}function uploadError(n,t){setUploadError(t);uploadFinished(n,t,"error")}function setUploadError(n){var i=findUploadElement(n);i.find(".uploadProgress").css("width","100%").addClass("uploadError").removeClass("uploadComplete");i.find(".progressPercent").html(' - <span class="error">'+t("E_UploadingFile")+"<\/span>")}function setUploadSuccess(n){var t=findUploadElement(n);t.find(".uploadProgress").css("width","100%").removeClass("uploadError").addClass("uploadComplete");t.find(".progressPercent").html(" - 100%")}function uploadCanceled(n,t){uploadFinished(n,t,"error")}function uploadFinished(n,t,i){var u=findUploadElement(t),r=null;try{r=JSON.parse(n.target.responseText)}catch(f){}r&&r.res=="error"||i!="ok"?(i="error",setUploadError(t)):(i="ok",setUploadSuccess(t));u.attr("data-ulpoad",i);checkUploadResult()}function checkUploadResult(){var t=$("#uploadFilesList .fileUpload").length,i=$("#uploadFilesList .fileUpload[data-ulpoad]").length,r=$('#uploadFilesList .fileUpload[data-ulpoad="ok"]').length,n;i==t&&(uploadFileList=[],n=Directory.Parse($("#hdDir").val()),n.ListFiles(!0),$("#btnUpload").button("disable"))}function fileUpload(n,t){var i=new XMLHttpRequest,r=new FormData,u=findUploadElement(t);u.find(".removeUpload").remove();r.append("action","upload");r.append("method","ajax");r.append("d",$("#hdDir").attr("value"));r.append("files[]",n);i.upload.addEventListener("progress",function(n){updateUploadProgress(n,t)},!1);i.addEventListener("load",function(n){uploadComplete(n,t)},!1);i.addEventListener("error",function(n){uploadError(n,t)},!1);i.addEventListener("abort",function(n){uploadCanceled(n,t)},!1);i.open("POST",RoxyFilemanConf.UPLOAD,!0);i.setRequestHeader("Accept","*/*");i.send(r)}function dropFiles(n,t){n&&n.dataTransfer&&n.dataTransfer.files?(addFile(),t?addUploadFiles(n.dataTransfer.files):listUploadFiles(n.dataTransfer.files)):addFile()}function clearFileField(n){n||(n="#fileUploads");try{$(n).val("");$(n).val(null)}catch(t){}}function addFileClick(){$("#uploadResult").html("");showUploadList([]);addFile()}function addFile(){clickFirstOnEnter("dlgAddFile");$("#uploadResult").html("");clearFileField();var n={};n[t("Upload")]={id:"btnUpload",text:t("Upload"),disabled:!0,click:function(){if($("#fileUploads").val()||uploadFileList&&uploadFileList.length!=0)if(RoxyFilemanConf.UPLOAD)if(window.FormData&&window.XMLHttpRequest&&window.FileList&&uploadFileList&&uploadFileList.length>0)for(i=0;i<uploadFileList.length;i++)fileUpload(uploadFileList[i],i);else document.forms.addfile.action=RoxyFilemanConf.UPLOAD,document.forms.addfile.submit();else alert(t("E_ActionDisabled"));else alert(t("E_SelectFiles"))}};n[t("Cancel")]=function(){$("#dlgAddFile").dialog("close")};$("#dlgAddFile").dialog({title:t("T_AddFile"),modal:!0,buttons:n,width:400})}function fileUploaded(n){var t;n.res=="ok"&&n.msg?($("#dlgAddFile").dialog("close"),t=Directory.Parse($("#hdDir").val()),t.ListFiles(!0),alert(n.msg)):n.res=="ok"?($("#dlgAddFile").dialog("close"),t=Directory.Parse($("#hdDir").val()),t.ListFiles(!0)):alert(n.msg)}function renameDir(){var n=getSelectedDir(),i;if(n){if($('[data-path="'+n.fullPath+'"]').parents("li").length<1){alert(t("E_CannotRenameRoot"));return}clickFirstOnEnter("pnlDirName");$("#txtDirName").val(n.name);i={};i[t("RenameDir")]=function(){var i=$.trim($("#txtDirName").val());i||alert(t("E_MissingDirName"));n.Rename(i)&&$("#pnlDirName").dialog("close")};i[t("Cancel")]=function(){$("#pnlDirName").dialog("close")};$("#pnlDirName").dialog({title:t("T_RenameDir"),modal:!0,buttons:i});RoxyUtils.SelectText("txtDirName",0,new String(n.name).length)}}function renameFile(){var n=getSelectedFile(),i;n&&(clickFirstOnEnter("pnlRenameFile"),$("#txtFileName").val(n.name),i={},i[t("RenameFile")]=function(){var t=$.trim($("#txtFileName").val());t?n.Rename(t)&&($('li[data-path="'+n.fullPath+'"] .name').text(t),$('li[data-path="'+n.fullPath+'"]').attr("data-path",RoxyUtils.MakePath(n.path,t)),$("#pnlRenameFile").dialog("close")):alert("Missing file name")},i[t("Cancel")]=function(){$("#pnlRenameFile").dialog("close")},$("#pnlRenameFile").dialog({title:t("T_RenameFile"),modal:!0,buttons:i}),n.name.lastIndexOf(".")>0&&RoxyUtils.SelectText("txtFileName",0,n.name.lastIndexOf(".")))}function getSelectedFile(){var n=null;return $("#pnlFileList .selected").length>0&&(n=new File($("#pnlFileList .selected").attr("data-path"))),n}function getSelectedDir(){var n=null;return $("#pnlDirList .selected")&&(n=Directory.Parse($("#pnlDirList .selected").closest("li").attr("data-path"))),n}function deleteDir(n){var i=null;i=n?Directory.Parse(n):getSelectedDir();i&&confirm(t("Q_DeleteFolder"))&&i.Delete()}function deleteFile(){var n=getSelectedFile();n&&confirm(t("Q_DeleteFile"))&&n.Delete()}function previewFile(){var n=getSelectedFile();n&&window.open(n.fullPath)}function downloadFile(){var n=getSelectedFile(),i;n&&RoxyFilemanConf.DOWNLOAD?(i=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOAD,"f",n.fullPath),window.frames.frmUploadFile.location.href=i):RoxyFilemanConf.DOWNLOAD||alert(t("E_ActionDisabled"))}function downloadDir(){var n=getSelectedDir(),i;n&&RoxyFilemanConf.DOWNLOADDIR?(i=RoxyUtils.AddParam(RoxyFilemanConf.DOWNLOADDIR,"d",n.fullPath),window.frames.frmUploadFile.location.href=i):RoxyFilemanConf.DOWNLOAD||alert(t("E_ActionDisabled"))}function closeMenus(n){n&&n!="dir"||$("#menuDir").fadeOut();n&&n!="file"||$("#menuFile").fadeOut()}function selectFirst(){var n=$("#pnlDirList li:first").children("div").first();n.length>0?selectDir(n):window.setTimeout("selectFirst()",300)}function tooltipContent(){if($("#menuFile").is(":visible"))return"";var i="",n=File.Parse($(this).attr("data-path"));return $("#hdViewType").val()=="thumb"&&n.IsImage()?i=n.fullPath+'<br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(n.size)+"<\/span>":n.IsImage()?(RoxyFilemanConf.GENERATETHUMB?(imgUrl=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",n.fullPath),imgUrl=RoxyUtils.AddParam(imgUrl,"width",RoxyFilemanConf.PREVIEW_THUMB_WIDTH),imgUrl=RoxyUtils.AddParam(imgUrl,"height",RoxyFilemanConf.PREVIEW_THUMB_HEIGHT)):imgUrl=n.fullPath,i='<img data-src="'+imgUrl+'" class="imgPreview lazyload"><br>'+n.name+' <br><span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(n.size)+" <\/span>"):i=n.fullPath+' <span class="filesize">'+t("Size")+": "+RoxyUtils.FormatFileSize(n.size)+"<\/span>",i}function filterFiles(){var t=$("#txtSearch").val(),n;if($("#pnlSearchNoFiles").hide(),$("#pnlFileList li").length!=0){if(!t){$("#pnlFileList li").show();return}n=0;$("#pnlFileList li").each(function(){var i=$(this).children(".name").text();i.toLowerCase().indexOf(t.toLowerCase())>-1?(n++,$(this).show()):($(this).removeClass("selected"),$(this).hide())});n==0&&$("#pnlSearchNoFiles").show()}}function sortFiles(){var n=getSelectedDir();n&&(n.ListFiles(),filterFiles(),switchView($("#hdViewType").val()))}function switchView(n){if(n!=$("#hdViewType").val()){if(n||(n=$("#hdViewType").val()),$(".btnView").removeClass("selected"),n=="thumb"){if($("#pnlFileList .icon").attr("src","images/blank.gif"),$("#pnlFileList").addClass("thumbView"),$("#dynStyle").length==0){$("head").append('<style id="dynStyle" />');var t="ul#pnlFileList.thumbView li{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}";t+="ul#pnlFileList.thumbView li{height:"+(parseInt(RoxyFilemanConf.THUMBS_VIEW_HEIGHT)+20)+"px;}";t+="ul#pnlFileList.thumbView .icon{width:"+RoxyFilemanConf.THUMBS_VIEW_WIDTH+"px;}";t+="ul#pnlFileList.thumbView .icon{height:"+RoxyFilemanConf.THUMBS_VIEW_HEIGHT+"px;}";$("#dynStyle").html(t)}$("#pnlFileList li").each(function(){var n=$(this).attr("data-icon-big");RoxyFilemanConf.GENERATETHUMB&&RoxyUtils.IsImage($(this).attr("data-path"))&&(n=RoxyUtils.AddParam(RoxyFilemanConf.GENERATETHUMB,"f",n),n=RoxyUtils.AddParam(n,"width",RoxyFilemanConf.THUMBS_VIEW_WIDTH),n=RoxyUtils.AddParam(n,"height",RoxyFilemanConf.THUMBS_VIEW_HEIGHT));$(this).children(".icon").css("background-image","url("+n+")");$(this).tooltip("option","show",{delay:50})});$("#btnThumbView").addClass("selected")}else $("#pnlFileList").removeClass("thumbView"),$("#pnlFileList li").each(function(){$(this).children(".icon").css("background-image","").attr("src",$(this).attr("data-icon"));$(this).tooltip("option","show",{delay:500})}),$("#btnListView").addClass("selected");$("#hdViewType").val(n);RoxyUtils.SetCookie("roxyview",n,10)}}function Clipboard(n,t){this.action=n;this.obj=t}function cutDir(){var n=getSelectedDir();n&&(setClipboard("cut",n),n.GetElement().addClass("pale"))}function copyDir(){var n=getSelectedDir();n&&setClipboard("copy",n)}function cutFile(){var n=getSelectedFile();n&&(setClipboard("cut",n),n.GetElement().addClass("pale"))}function copyFile(){var n=getSelectedFile();n&&setClipboard("copy",n)}function pasteToFiles(n,t){if($(t).hasClass("pale"))return n.stopPropagation(),!1;var i=getSelectedDir();return i||(i=Directory.Parse($("#pnlDirList li:first").children("div").first())),i&&clipBoard&&clipBoard.obj&&(clipBoard.action=="copy"?clipBoard.obj.Copy(i.fullPath):(clipBoard.obj.Move(i.fullPath),clearClipboard())),!0}function pasteToDirs(n,t){if($(t).hasClass("pale"))return n.stopPropagation(),!1;var i=getSelectedDir();return i||(i=Directory.Parse($("#pnlDirList li:first").children("div").first())),clipBoard&&i?clipBoard.action=="copy"?clipBoard.obj.Copy(i.fullPath):(clipBoard.obj.Move(i.fullPath),clearClipboard(),i.ListFiles(!0)):alert("error"),!0}function clearClipboard(){$("#pnlDirList li").removeClass("pale");$("#pnlFileList li").removeClass("pale");clipBoard=null;$(".paste").addClass("pale")}function setClipboard(n,t){clearClipboard();t&&(clipBoard=new Clipboard(n,t),$(".paste").removeClass("pale"))}function ResizeLists(){var n=$(window).innerHeight()-$("#fileActions .actions").outerHeight()-$(".bottomLine").outerHeight();$(".scrollPane").css("height",n)}function removeDisabledActions(){RoxyFilemanConf.CREATEDIR==""&&($("#mnuCreateDir").next().remove(),$("#mnuCreateDir").remove(),$("#btnAddDir").remove());RoxyFilemanConf.DELETEDIR==""&&($("#mnuDeleteDir").prev().remove(),$("#mnuDeleteDir").remove(),$("#btnDeleteDir").remove());RoxyFilemanConf.MOVEDIR==""&&($("#mnuDirCut").next().remove(),$("#mnuDirCut").remove());RoxyFilemanConf.COPYDIR==""&&($("#mnuDirCopy").next().remove(),$("#mnuDirCopy").remove());RoxyFilemanConf.COPYDIR==""&&RoxyFilemanConf.MOVEDIR==""&&($("#mnuDirPaste").next().remove(),$("#mnuDirPaste").remove());RoxyFilemanConf.RENAMEDIR==""&&($("#mnuRenameDir").next().remove(),$("#mnuRenameDir").remove(),$("#btnRenameDir").remove());RoxyFilemanConf.UPLOAD==""&&$("#btnAddFile").remove();RoxyFilemanConf.DOWNLOAD==""&&($("#mnuDownload").next().remove(),$("#mnuDownload").remove());RoxyFilemanConf.DOWNLOADDIR==""&&($("#mnuDownloadDir").next().remove(),$("#mnuDownloadDir").remove());RoxyFilemanConf.DELETEFILE==""&&($("#mnuDeleteFile").prev().remove(),$("#mnuDeleteFile").remove(),$("#btnDeleteFile").remove());RoxyFilemanConf.MOVEFILE==""&&($("#mnuFileCut").next().remove(),$("#mnuFileCut").remove());RoxyFilemanConf.COPYFILE==""&&($("#mnuFileCopy").next().remove(),$("#mnuFileCopy").remove());RoxyFilemanConf.COPYFILE==""&&RoxyFilemanConf.MOVEFILE==""&&($("#mnuFilePaste").next().remove(),$("#mnuFilePaste").remove());RoxyFilemanConf.RENAMEFILE==""&&($("#mnuRenameFile").next().remove(),$("#mnuRenameFile").remove(),$("#btnRenameFile").remove())}function getPreselectedFile(){var n=RoxyUtils.GetUrlParam("selected"),r,i,t;if(!n)switch(getFilemanIntegration()){case"ckeditor":try{r=window.opener.CKEDITOR.dialog.getCurrent();n=r.getValueOf("info",r.getName()=="link"?"url":"txtUrl")}catch(u){}break;case"tinymce3":try{i=tinyMCEPopup.getWindowArg("window");n=i.document.getElementById(tinyMCEPopup.getWindowArg("input")).value;n.indexOf("..")==0&&(n=n.substr(2))}catch(u){}break;case"tinymce4":try{i=window.opener?window.opener:window.parent;n=i.document.getElementById(RoxyUtils.GetUrlParam("input")).value;n.indexOf("..")==0&&(n=n.substr(2))}catch(u){}break;default:n=GetSelectedValue()}return RoxyFilemanConf.RETURN_URL_PREFIX&&(t=RoxyFilemanConf.RETURN_URL_PREFIX,n.indexOf(t)==0&&(t.substr(-1)=="/"&&(t=t.substr(0,t.length-1)),n=n.substr(t.length))),n}function initSelection(n){var t=!1,r=!0,u,i;if(n||(n=getPreselectedFile()),!n&&RoxyUtils.ToBool(RoxyFilemanConf.OPEN_LAST_DIR)&&(n=getLastDir(),r=!1),n){u=r?RoxyUtils.GetPath(n):n;i=tmp=Directory.Parse(u);do tmp&&(tmp.Expand(!0),t=!0),tmp=Directory.Parse(tmp.path);while(tmp);i&&(i.Select(n),t=!0)}t||selectFirst()}function getFilemanIntegration(){var n=RoxyUtils.GetUrlParam("integration");return n||(n=RoxyFilemanConf.INTEGRATION),n.toLowerCase()}function setFile(){var u=getSelectedFile(),i,r,n;if(!u){alert(t("E_NoFileSelected"));return}i=u.fullPath;RoxyFilemanConf.RETURN_URL_PREFIX&&(r=RoxyFilemanConf.RETURN_URL_PREFIX,r.substr(-1)=="/"&&(r=r.substr(0,r.length-1)),i=r+(i.substr(0,1)!="/"?"/":"")+i);switch(getFilemanIntegration()){case"ckeditor":window.opener.CKEDITOR.tools.callFunction(RoxyUtils.GetUrlParam("CKEditorFuncNum"),i);self.close();break;case"tinymce3":n=tinyMCEPopup.getWindowArg("window");n.document.getElementById(tinyMCEPopup.getWindowArg("input")).value=i;typeof n.ImageDialog!="undefined"&&(n.ImageDialog.getImageData&&n.ImageDialog.getImageData(),n.ImageDialog.showPreviewImage&&n.ImageDialog.showPreviewImage(i));tinyMCEPopup.close();break;case"tinymce4":n=window.opener?window.opener:window.parent;n.document.getElementById(RoxyUtils.GetUrlParam("input")).value=i;typeof n.ImageDialog!="undefined"&&(n.ImageDialog.getImageData&&n.ImageDialog.getImageData(),n.ImageDialog.showPreviewImage&&n.ImageDialog.showPreviewImage(i));n.tinyMCE.activeEditor.windowManager.close();break;default:FileSelected(u)}}var uploadFileList,clipBoard;$.ajaxSetup({cache:!1});uploadFileList=[];clipBoard=null;$(function(){var i,t,n;if(RoxyUtils.LoadConfig(),i=new Directory,i.LoadAll(),$("#wraper").show(),window.setTimeout("initSelection()",100),RoxyUtils.Translate(),$("body").click(function(){closeMenus()}),t=RoxyUtils.GetCookie("roxyview"),t||(t=RoxyFilemanConf.DEFAULTVIEW),t&&switchView(t),ResizeLists(),$(".actions input").tooltip({track:!0}),$(window).resize(ResizeLists),document.oncontextmenu=function(){return!1},removeDisabledActions(),$("#copyYear").html((new Date).getFullYear()),RoxyFilemanConf.UPLOAD&&RoxyFilemanConf.UPLOAD!=""&&(n=document.getElementById("fileActions"),n.ondragover=function(){return!1},n.ondragend=function(){return!1},n.ondrop=function(n){n.preventDefault();n.stopPropagation();dropFiles(n)},n=document.getElementById("dlgAddFile"),n.ondragover=function(){return!1},n.ondragend=function(){return!1},n.ondrop=function(n){n.preventDefault();n.stopPropagation();dropFiles(n,!0)}),getFilemanIntegration()=="tinymce3")try{$("body").append('<script src="js/tiny_mce_popup.js"><\/script>')}catch(r){}});