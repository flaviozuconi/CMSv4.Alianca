/*!
 * jQuery Popup Overlay
 *
 * @version 1.6.0
 * @requires jQuery v1.7.1+
 * @link http://vast-eng.github.com/jquery-popup-overlay/
 */
(function(n){var p=n(window),r={},i=[],f=[],e=!1,o=!1,s,h=null,c=null,l=null,a=null,v="_open",w="_close",y=null,t={_init:function(r){var u=n(r),e=u.data("popupoptions");f[r.id]=!1;i[r.id]=0;u.data("popup-initialized")||(u.attr("data-popup-initialized","true"),t._initonce(r));e.autoopen&&setTimeout(function(){t.show(r,0)},0)},_initonce:function(i){var o=n("body"),u,r=$el.data("popupoptions"),h,c,l,f,e,y;a=parseInt(o.css("margin-right"),10);r.type=="tooltip"&&(r.background=!1,r.scrolllock=!1);r.scrolllock&&typeof s=="undefined"&&(h=n('<div style="width:50px;height:50px;overflow:auto"><div/><\/div>').appendTo("body"),c=h.children(),s=c.innerWidth()-c.height(99).innerWidth(),h.remove());$el.attr("id")||$el.attr("id","j-popup-"+parseInt(Math.random()*1e8));$el.addClass("popup_content");o.prepend(i);$el.wrap('<div id="'+i.id+'_wrapper" class="popup_wrapper" />');u=n("#"+i.id+"_wrapper");u.css({opacity:0,visibility:"hidden",position:"absolute",overflow:"auto"});$el.css({opacity:0,visibility:"hidden",display:"inline-block"});r.setzindex&&!r.autozindex&&u.css("z-index","2001");r.outline||$el.css("outline","none");r.transition&&($el.css("transition",r.transition),u.css("transition",r.transition));n(i).attr("aria-hidden",!0);r.background&&!n("#"+i.id+"_background").length&&(l='<div id="'+i.id+'_background" class="popup_background"><\/div>',o.prepend(l),f=n("#"+i.id+"_background"),f.css({opacity:0,visibility:"hidden",backgroundColor:r.color,position:"fixed",top:0,right:0,bottom:0,left:0}),r.setzindex&&!r.autozindex&&f.css("z-index","2000"),r.transition&&f.css("transition",r.transition));r.type=="overlay"&&($el.css({textAlign:"left",position:"relative",verticalAlign:"middle"}),u.css({position:"fixed",top:0,right:0,left:0,bottom:0,textAlign:"center"}),u.append('<div class="popup_align" />'),n(".popup_align").css({display:"inline-block",verticalAlign:"middle",height:"100%"}));$el.attr("role","dialog");e=r.openelement?r.openelement:"."+i.id+v;n(e).each(function(t,i){n(i).attr("data-popup-ordinal",t);n(i).attr("id")||n(i).attr("id","open_"+parseInt(Math.random()*1e8,10))});$el.attr("aria-labelledby")||$el.attr("aria-label")||$el.attr("aria-labelledby",n(e).attr("id"));n(document).on("click",e,function(r){if(!$el.data("popup-visible")){var u=n(this).data("popup-ordinal");setTimeout(function(){t.show(i,u)},0);r.preventDefault()}});y=r.closeelement?r.closeelement:"."+i.id+w;n(document).on("click",y,function(n){t.hide(i);n.preventDefault()});r.detach?$el.hide().detach():u.hide()},show:function(r,v){var b=n(r),g,k;if(!b.data("popup-visible")){b.data("popup-initialized")||t._init(r);b.attr("data-popup-initialized","true");var nt=n("body"),w=b.data("popupoptions"),d=n("#"+r.id+"_wrapper"),it=n("#"+r.id+"_background");if(u(r,v,w.beforeopen),f[r.id]=v,w.detach?(d.prepend(r),b.show()):d.show(),setTimeout(function(){d.css({visibility:"visible",opacity:1});n("html").addClass("popup_visible").addClass("popup_visible_"+r.id);b.addClass("popup_content_visible")},20),b.css({visibility:"visible",opacity:1}),w.scrolllock&&(nt.css("overflow","hidden"),nt.height()>p.height()&&nt.css("margin-right",a+s)),setTimeout(function(){if(!e){if(w.keepfocus)n(document).on("focusin",h);if(w.blur)n(document).on("click",c);if(w.escape)n(document).on("keydown",l)}e?o=!0:e=!0},0),b.data("popup-visible",!0),t.reposition(r,v),w.background&&(it.css({visibility:"visible",opacity:w.opacity}),setTimeout(function(){it.css({opacity:w.opacity})},0)),y=document.activeElement,w.keepfocus&&(b.attr("tabindex",-1),setTimeout(function(){w.focuselement?n(w.focuselement).focus():b.focus()},w.focusdelay),h=function(n){var t=document.getElementById(r.id);t.contains(n.target)||(n.stopPropagation(),t.focus())}),w.autozindex){var rt=document.getElementsByTagName("*"),ut=rt.length,tt=0;for(g=0;g<ut;g++)k=n(rt[g]).css("z-index"),k!=="auto"&&(k=parseInt(k),tt<k&&(tt=k));i[r.id]=tt;i[r.id]>0&&d.css({zIndex:i[r.id]+2});w.background&&i[r.id]>0&&n("#"+r.id+"_background").css({zIndex:i[r.id]+1})}w.blur&&(c=function(i){n(i.target).parents().andSelf().is("#"+r.id)||t.hide(r)});w.escape&&(l=function(n){n.keyCode==27&&b.data("popup-visible")&&t.hide(r)});n(w.pagecontainer).attr("aria-hidden",!0);b.attr("aria-hidden",!1);d.one("transitionend",function(){u(r,v,w.opentransitionend)});u(r,v,w.onopen)}},hide:function(t){var v=n("body"),r=n(t),i=r.data("popupoptions"),s=n("#"+t.id+"_wrapper"),p=n("#"+t.id+"_background");r.data("popup-visible",!1);o?(n("html").removeClass("popup_visible_"+t.id),o=!1):(n("html").removeClass("popup_visible").removeClass("popup_visible_"+t.id),e=!1);r.removeClass("popup_content_visible");i.scrolllock&&setTimeout(function(){v.css({overflow:"visible","margin-right":a})},10);i.blur&&n(document).off("click",c);i.keepfocus&&(n(document).off("focusin",h),setTimeout(function(){n(y).is(":visible")&&y.focus()},0));i.escape&&n(document).off("keydown",l);s.css({visibility:"hidden",opacity:0});r.css({visibility:"hidden",opacity:0});i.background&&p.css({visibility:"hidden",opacity:0});r.one("transitionend",function(){r.data("popup-visible")||(i.detach?r.hide().detach():s.hide());i.notransitiondetach||u(t,f[t.id],i.closetransitionend)});i.notransitiondetach&&(i.detach?r.hide().detach():s.hide());n(i.pagecontainer).attr("aria-hidden",!1);r.attr("aria-hidden",!0);u(t,f[t.id],i.onclose)},toggle:function(n,i){$el.data("popup-visible")?t.hide(n):setTimeout(function(){t.show(n,i)},0)},reposition:function(t,i){var e=n(t),r=e.data("popupoptions"),u=n("#"+t.id+"_wrapper"),h=n("#"+t.id+"_background");if(i=i||0,r.type=="tooltip"){u.css({position:"absolute"});var s=r.openelement?r.openelement:"."+t.id+v,o=n(s+'[data-popup-ordinal="'+i+'"]'),f=o.offset();r.horizontal=="right"?u.css("left",f.left+o.outerWidth()+r.offsetleft):r.horizontal=="leftedge"?u.css("left",f.left+o.outerWidth()-o.outerWidth()+r.offsetleft):r.horizontal=="left"?u.css("right",n(window).width()-f.left-r.offsetleft):r.horizontal=="rightedge"?u.css("right",n(window).width()-f.left-o.outerWidth()-r.offsetleft):u.css("left",f.left+o.outerWidth()/2-e.outerWidth()/2-parseFloat(e.css("marginLeft"))+r.offsetleft);r.vertical=="bottom"?u.css("top",f.top+o.outerHeight()+r.offsettop):r.vertical=="bottomedge"?u.css("top",f.top+o.outerHeight()-e.outerHeight()+r.offsettop):r.vertical=="top"?u.css("bottom",n(window).height()-f.top-r.offsettop):r.vertical=="topedge"?u.css("bottom",n(window).height()-f.top-e.outerHeight()-r.offsettop):u.css("top",f.top+o.outerHeight()/2-e.outerHeight()/2-parseFloat(e.css("marginTop"))+r.offsettop)}else r.type=="overlay"&&(r.horizontal?u.css("text-align",r.horizontal):u.css("text-align","center"),r.vertical?e.css("vertical-align",r.vertical):e.css("vertical-align","middle"))}},u=function(t,i,u){var f=r.openelement?r.openelement:"."+t.id+v,e=n(f+'[data-popup-ordinal="'+i+'"]');typeof u=="function"&&u(e)};n.fn.popup=function(i){return this.each(function(){if($el=n(this),typeof i=="object"){var u=n.extend({},n.fn.popup.defaults,i);$el.data("popupoptions",u);r=$el.data("popupoptions");t._init(this)}else typeof i=="string"?($el.data("popupoptions")||($el.data("popupoptions",n.fn.popup.defaults),r=$el.data("popupoptions")),t[i].call(this,this)):($el.data("popupoptions")||($el.data("popupoptions",n.fn.popup.defaults),r=$el.data("popupoptions")),t._init(this))})};n.fn.popup.defaults={type:"overlay",autoopen:!1,background:!0,color:"black",opacity:"0.5",horizontal:"center",vertical:"middle",offsettop:0,offsetleft:0,escape:!0,blur:!0,setzindex:!0,autozindex:!1,scrolllock:!1,keepfocus:!0,focuselement:null,focusdelay:50,outline:!1,pagecontainer:null,detach:!1,openelement:null,closeelement:null,transition:null,notransitiondetach:!1,beforeopen:function(){},onclose:function(){},onopen:function(){},opentransitionend:function(){},closetransitionend:function(){}}})(jQuery);